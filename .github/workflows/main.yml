name: SSH Tunnel with Localtonet

on:
  workflow_dispatch:

jobs:
  ssh-setup:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ Gereksinimleri yÃ¼kle
        run: |
          sudo apt update
          sudo apt install -y openssh-server wget unzip

      - name: ğŸ”‘ SSH anahtarÄ± oluÅŸtur ve yetkilendir
        run: |
          KEYFILE="/root/.ssh/id_ed25519"
          sudo mkdir -p /root/.ssh
          sudo chmod 700 /root/.ssh
          sudo ssh-keygen -t ed25519 -f "$KEYFILE" -N ""
          sudo cat "${KEYFILE}.pub" | sudo tee -a /root/.ssh/authorized_keys
          sudo chmod 600 /root/.ssh/authorized_keys
          sudo chmod 600 "${KEYFILE}"
          sudo chmod 644 "${KEYFILE}.pub"

      - name: ğŸš€ SSH servisini baÅŸlat
        run: sudo service ssh start

      - name: ğŸ“¤ SSH anahtarÄ±nÄ± ve IPâ€™yi gÃ¶ster
        run: |
          echo -e "\nğŸ”‘ SSH Private Key:"
          sudo cat /root/.ssh/id_ed25519
          echo -e "\nğŸ“Œ IP Adresiniz:"
          curl -s ifconfig.me
          echo -e "\nğŸŸ¢ SSH servisi Ã§alÄ±ÅŸÄ±yor. 22. port aÃ§Ä±k olmalÄ±."

      - name: ğŸ“¥ Localtonet indir ve kur
        run: |
          cd /opt
          sudo wget https://localtonet.com/download/localtonet-linux-x64.zip -O localtonet.zip
          sudo unzip -o localtonet.zip
          sudo chmod +x localtonet

      - name: ğŸ” Localtonet baÅŸlat
        env:
          TOKEN: ${{ secrets.LOCALTOKEN }}
        run: |
          echo -e "\nğŸš€ Localtonet baÅŸlatÄ±lÄ±yor..."
          sudo /opt/localtonet tunnel --token $TOKEN
