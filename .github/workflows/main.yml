name: Localtonet Tunnel

on:
  workflow_dispatch:

jobs:
  create-tunnel:
    runs-on: ubuntu-latest

    steps:
    - name: Tunnel baÅŸlatÄ±lÄ±yor...
      shell: bash
      run: |
        echo "TÃ¼nel baÅŸlatÄ±lÄ±yor..."

        # Token buraya gelsin (gizli tut!)
        TOKEN="Senin-Localtonet-Token"

        # Localtonet indir
        wget -q https://localtonet.com/download/localtonet-linux-x64.zip
        unzip -q localtonet-linux-x64.zip
        chmod +x localtonet

        # Arka planda baÅŸlatÄ±p loga yaz
        ./localtonet tunnel 22 --authtoken $TOKEN > tnl.log 2>&1 &

        echo "TÃ¼nel logu izleniyor..."
        
        # BaÄŸlantÄ± oluÅŸana kadar en fazla 20 saniye bekle
        for i in {1..20}; do
          sleep 1
          LINK=$(grep -oE 'https://[a-zA-Z0-9.-]+.loca.lt' tnl.log || true)
          if [[ ! -z "$LINK" ]]; then
            echo "âœ… TÃ¼nel baÄŸlantÄ±sÄ± bulundu!"
            echo "BaÄŸlantÄ±: $LINK"
            echo
            echo "ğŸ” SSH komutu:"
            echo 'ssh -o StrictHostKeyChecking=no -p 22 USER@'"$LINK"
            echo
            echo "ğŸ§‘ KullanÄ±cÄ±:"
            whoami
            exit 0
          fi
        done

        echo "â€¼ï¸ Localtonet baÄŸlantÄ± linki bulunamadÄ±!"
        echo "::error::TÃ¼nel baÅŸarÄ±sÄ±z oldu."
        exit 1
