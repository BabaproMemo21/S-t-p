name: Run SSH Tunnel

on:
  workflow_dispatch:

jobs:
  ssh:
    runs-on: ubuntu-latest

    steps:
      - name: LocalToNet indir
        run: |
          wget https://localtonet.com/download/localtonet-linux-x64.zip
          unzip localtonet-linux-x64.zip
          chmod +x localtonet

      - name: SSH Key oluÅŸtur
        run: |
          mkdir -p ~/.ssh
          ssh-keygen -t rsa -f ~/.ssh/id_rsa -q -N ""
          echo "ðŸ—ï¸ SSH Public Key:"
          cat ~/.ssh/id_rsa.pub
          echo ""
          echo "ðŸ§‘ KullanÄ±cÄ± adÄ±:"
          whoami

      - name: SSH server baÅŸlat
        run: |
          sudo apt-get update
          sudo apt-get install -y openssh-server
          sudo service ssh start

      - name: Localtonet baÅŸlat ve linki al
        id: baglanti
        run: |
          ./localtonet --port 22 > log.txt 2>&1 &
          echo "ðŸ• TÃ¼nel baÅŸlatÄ±lÄ±yor..."
          sleep 20
          echo "ðŸ“„ LOG DOSYASI:"
          cat log.txt
          LINK=$(grep -oE 'tcp://[a-zA-Z0-9./:-]+' log.txt | head -n 1)
          echo "ðŸ“¡ BaÄŸlantÄ± linki: $LINK"
          echo "ssh_link=$LINK" >> $GITHUB_OUTPUT

      - name: SSH komutu ve indirme baÄŸlantÄ±sÄ±
        run: |
          echo "ðŸ”— SSH baÄŸlantÄ± linki: ${{ steps.baglanti.outputs.ssh_link }}"
          echo "ðŸ“¥ indirme baÄŸlantÄ±sÄ±:"
          echo "${{ steps.baglanti.outputs.ssh_link }}" > link.txt
