name: SSH Bağlantısı

on:
  workflow_dispatch:

jobs:
  ssh-baglantisi:
    runs-on: ubuntu-latest
    steps:
      - name: localtonet indir
        run: |
          wget https://localtonet.com/download/localtonet-linux-x64.zip
          unzip localtonet-linux-x64.zip
          chmod +x ./localtonet

      - name: SSH Tünel Aç
        run: |
          nohup ./localtonet token ${{ secrets.AUTH_TOKEN }} > output.log 2>&1 &
          sleep 15
          cat output.log | tee debug.log

      - name: Kullanıcıyı Yazdır ve Bağlantıyı Kur
        id: sshhazirlik
        run: |
          echo "Kullanıcı: $(whoami)" > ssh.txt
          echo "Bağlantı: ssh -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa $(whoami)@z4hzlp5rk.localto.net" >> ssh.txt

      - name: SSH Bilgisi Paylaş
        uses: actions/upload-artifact@v4
        with:
          name: ssh_bilgisi
          path: ssh.txt
